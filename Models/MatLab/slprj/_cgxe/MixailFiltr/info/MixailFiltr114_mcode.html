<!-- saved from url=(0014)about:internet -->
<html>
<body>
<script src="resources/eml_report_loadable_data.js"></script>
<div class="dead">
<pre class="code">
<span class="srcline"><span class="lineno"><a href="11,1" id="srcline1">  1</a></span><span class="line"><span class="keyword">classdef</span> <span class="mxinfo " id="T6:U1">MixailFiltr1</span> &lt;   matlab.System &amp; matlab.system.mixin.Propagates</span></span>
<span class="srcline"><span class="lineno"><a href="11,2" id="srcline2">  2</a></span><span class="line">    <span class="comment">% handle &amp;</span></span></span>
<span class="srcline"><span class="lineno"><a href="11,3" id="srcline3">  3</a></span><span class="line">    <span class="keyword">properties</span></span></span>
<span class="srcline"><span class="lineno"><a href="11,4" id="srcline4">  4</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="11,5" id="srcline5">  5</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="11,6" id="srcline6">  6</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="11,7" id="srcline7">  7</a></span><span class="line">    <span class="keyword">properties</span>(DiscreteState)</span></span>
<span class="srcline"><span class="lineno"><a href="11,8" id="srcline8">  8</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="11,9" id="srcline9">  9</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="11,10" id="srcline10"> 10</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="11,11" id="srcline11"> 11</a></span><span class="line">    <span class="comment">% Pre-computed constants</span></span></span>
<span class="srcline"><span class="lineno"><a href="11,12" id="srcline12"> 12</a></span><span class="line">    <span class="keyword">properties</span>(SetAccess  = private)</span></span>
<span class="srcline"><span class="lineno"><a href="11,13" id="srcline13"> 13</a></span><span class="line">        <span class="var type0" id="S4T0U19">M1</span> = zeros(151, 1)</span></span>
<span class="srcline"><span class="lineno"><a href="11,14" id="srcline14"> 14</a></span><span class="line">        <span class="var type0" id="S6T0U25">M1count</span> = 151 </span></span>
<span class="srcline"><span class="lineno"><a href="11,15" id="srcline15"> 15</a></span><span class="line">        <span class="var type0" id="S7T0U28">M2</span> = zeros(91, 1)</span></span>
<span class="srcline"><span class="lineno"><a href="11,16" id="srcline16"> 16</a></span><span class="line">        <span class="var type0" id="S8T0U34">M2count</span> = 101</span></span>
<span class="srcline"><span class="lineno"><a href="11,17" id="srcline17"> 17</a></span><span class="line">        <span class="var type0" id="S9T0U37">M3</span> =  zeros(51, 1)</span></span>
<span class="srcline"><span class="lineno"><a href="11,18" id="srcline18"> 18</a></span><span class="line">        <span class="var type0" id="S10T0U43">M3count</span> =  51</span></span>
<span class="srcline"><span class="lineno"><a href="11,19" id="srcline19"> 19</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="11,20" id="srcline20"> 20</a></span><span class="line">        <span class="var type0" id="S11T0U46">myFront</span> = struct(<span class="string">'front'</span>, 0, <span class="string">'frontCount'</span>, 0, <span class="string">'is_front'</span>, false,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="11,21" id="srcline21"> 21</a></span><span class="line">                            <span class="string">'i_tik'</span>, 1, <span class="string">'i_tik_save'</span>, 0, <span class="string">'i_sum_front'</span>, 0, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="11,22" id="srcline22"> 22</a></span><span class="line">                            <span class="string">'i_sum_tek_front'</span>, 0, <span class="string">'i_n_count_ntime'</span>, 0,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="11,23" id="srcline23"> 23</a></span><span class="line">                            <span class="string">'is_signal'</span>, false,  <span class="string">'i_nCount_tic_null'</span>, 70)</span></span>
<span class="srcline"><span class="lineno"><a href="11,24" id="srcline24"> 24</a></span><span class="line">        <span class="var type0" id="S14T0U72">mySigmoid</span> = struct(<span class="string">'IsForm'</span>, false, <span class="string">'nCount'</span>, 0)</span></span>
<span class="srcline"><span class="lineno"><a href="11,25" id="srcline25"> 25</a></span><span class="line">        <span class="var type0" id="S15T0U81">point</span> = struct(<span class="string">'y1'</span>, 0, <span class="string">'y0'</span>, 0)</span></span>
<span class="srcline"><span class="lineno"><a href="11,26" id="srcline26"> 26</a></span><span class="line">        <span class="var type0" id="S16T0U89">ind</span> = struct(<span class="string">'sig'</span>, 0, <span class="string">'nCount'</span>, 0, <span class="string">'i'</span>, 0)</span></span>
<span class="srcline"><span class="lineno"><a href="11,27" id="srcline27"> 27</a></span><span class="line">        <span class="var type0" id="S17T0U99">i</span>, <span class="var type0" id="S18T0U101">j</span>, <span class="var type0" id="S19T0U103">k</span>, </span></span>
<span class="srcline"><span class="lineno"><a href="11,28" id="srcline28"> 28</a></span><span class="line">        <span class="var type0" id="S20T0U105">u_tek</span>, <span class="var type0" id="S21T0U107">u_delta</span>, <span class="var type0" id="S22T0U109">u_sm</span>, <span class="var type0" id="S23T0U111">u_sig_k</span></span></span>
<span class="srcline"><span class="lineno"><a href="11,29" id="srcline29"> 29</a></span><span class="line">        <span class="var type0" id="S24T0U113">y_old</span>, <span class="var type0" id="S25T0U115">nEma</span>, <span class="var type0" id="S26T0U117">alfa_ema</span></span></span>
<span class="srcline"><span class="lineno"><a href="11,30" id="srcline30"> 30</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="11,31" id="srcline31"> 31</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="11,32" id="srcline32"> 32</a></span><span class="line">    <span class="keyword">properties</span>(Access  = private)</span></span>
<span class="srcline"><span class="lineno"><a href="11,33" id="srcline33"> 33</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="11,34" id="srcline34"> 34</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="11,35" id="srcline35"> 35</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="11,36" id="srcline36"> 36</a></span><span class="line">    <span class="keyword">methods</span>(Access = protected)</span></span>
<span class="srcline"><span class="lineno"><a href="11,37" id="srcline37"> 37</a></span><span class="line">        <span class="keyword">function</span> setupImpl(<span class="var type0" id="S28T0U132">obj</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="11,38" id="srcline38"> 38</a></span><span class="line">            <span class="var type0" id="S28T0U136">obj</span>.u_tek = 0; </span></span>
<span class="srcline"><span class="lineno"><a href="11,39" id="srcline39"> 39</a></span><span class="line">            <span class="var type0" id="S28T0U142">obj</span>.u_delta = 0; </span></span>
<span class="srcline"><span class="lineno"><a href="11,40" id="srcline40"> 40</a></span><span class="line">            <span class="var type0" id="S28T0U148">obj</span>.u_sm = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="11,41" id="srcline41"> 41</a></span><span class="line">            set_sig(<span class="var type0" id="S28T0U154">obj</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="11,42" id="srcline42"> 42</a></span><span class="line">            <span class="var type0" id="S28T0U158">obj</span>.i=0;</span></span>
<span class="srcline"><span class="lineno"><a href="11,43" id="srcline43"> 43</a></span><span class="line">            <span class="var type0" id="S28T0U164">obj</span>.u_sig_k=0;</span></span>
<span class="srcline"><span class="lineno"><a href="11,44" id="srcline44"> 44</a></span><span class="line">            <span class="var type0" id="S28T0U171">obj</span>.myFront.i_nCount_tic_null=70;</span></span>
<span class="srcline"><span class="lineno"><a href="11,45" id="srcline45"> 45</a></span><span class="line">            <span class="var type0" id="S28T0U178">obj</span>.u_sig_k=0.0;</span></span>
<span class="srcline"><span class="lineno"><a href="11,46" id="srcline46"> 46</a></span><span class="line">            <span class="var type0" id="S28T0U184">obj</span>.y_old=0;</span></span>
<span class="srcline"><span class="lineno"><a href="11,47" id="srcline47"> 47</a></span><span class="line">            <span class="var type0" id="S28T0U190">obj</span>.nEma=5;</span></span>
<span class="srcline"><span class="lineno"><a href="11,48" id="srcline48"> 48</a></span><span class="line">            <span class="var type0" id="S28T0U196">obj</span>.alfa_ema=2/(<span class="var type0" id="S28T0U203">obj</span>.nEma+1);</span></span>
<span class="srcline"><span class="lineno"><a href="11,49" id="srcline49"> 49</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="11,50" id="srcline50"> 50</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="11,51" id="srcline51"> 51</a></span><span class="line">        <span class="keyword">function</span> <span class="var type0" id="S31T0U208">y</span> = stepImpl(<span class="var type0" id="S32T0U211">obj</span>,<span class="var type0" id="S33T0U212">u</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="11,52" id="srcline52"> 52</a></span><span class="line">            <span class="keyword">if</span> <span class="var type0" id="S32T0U218">obj</span>.ind.sig==0</span></span>
<span class="srcline"><span class="lineno"><a href="11,53" id="srcline53"> 53</a></span><span class="line">                inicial_ind(<span class="var type0" id="S32T0U225">obj</span>, 1)</span></span>
<span class="srcline"><span class="lineno"><a href="11,54" id="srcline54"> 54</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="11,55" id="srcline55"> 55</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="11,56" id="srcline56"> 56</a></span><span class="line">            get_front(<span class="var type0" id="S32T0U230">obj</span>, <span class="var type0" id="S33T0U231">u</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="11,57" id="srcline57"> 57</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="11,58" id="srcline58"> 58</a></span><span class="line">            <span class="var type0" id="S31T0U234">y</span> = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="11,59" id="srcline59"> 59</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="11,60" id="srcline60"> 60</a></span><span class="line">            <span class="keyword">if</span> abs(<span class="var type0" id="S32T0U243">obj</span>.myFront.i_sum_front) &gt;0 <span class="comment">% !!! проверить условия</span></span></span>
<span class="srcline"><span class="lineno"><a href="11,61" id="srcline61"> 61</a></span><span class="line"><span class="comment">%            if abs(obj.myFront.is_front) &gt;0 % !!! проверить условия</span></span></span>
<span class="srcline"><span class="lineno"><a href="11,62" id="srcline62"> 62</a></span><span class="line">                <span class="var type0" id="S31T0U249">y</span> = step_func3(<span class="var type0" id="S32T0U252">obj</span>, <span class="var type0" id="S33T0U253">u</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="11,63" id="srcline63"> 63</a></span><span class="line">            <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="11,64" id="srcline64"> 64</a></span><span class="line">                <span class="var type0" id="S31T0U257">y</span>=<span class="var type0" id="S32T0U259">obj</span>.u_tek;</span></span>
<span class="srcline"><span class="lineno"><a href="11,65" id="srcline65"> 65</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="11,66" id="srcline66"> 66</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="11,67" id="srcline67"> 67</a></span><span class="line">            <span class="var type0" id="S38T0U263">x</span>=<span class="var type0" id="S31T0U265">y</span> - <span class="var type0" id="S32T0U267">obj</span>.y_old;</span></span>
<span class="srcline"><span class="lineno"><a href="11,68" id="srcline68"> 68</a></span><span class="line">            <span class="var type0" id="S31T0U271">y</span> = <span class="var type0" id="S32T0U274">obj</span>.y_old + <span class="var type0" id="S32T0U278">obj</span>.alfa_ema*(<span class="var type0" id="S38T0U281">x</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="11,69" id="srcline69"> 69</a></span><span class="line">            <span class="var type0" id="S32T0U285">obj</span>.y_old=<span class="var type0" id="S31T0U287">y</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="11,70" id="srcline70"> 70</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="11,71" id="srcline71"> 71</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="11,72" id="srcline72"> 72</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="11,73" id="srcline73"> 73</a></span><span class="line">        <span class="keyword">function</span> resetImpl(<span class="var type0" id="S40T0U292">obj</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="11,74" id="srcline74"> 74</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="11,75" id="srcline75"> 75</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="11,76" id="srcline76"> 76</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="11,77" id="srcline77"> 77</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="11,78" id="srcline78"> 78</a></span><span class="line">    <span class="keyword">methods</span>(Access = private)</span></span>
<span class="srcline"><span class="lineno"><a href="11,79" id="srcline79"> 79</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="11,80" id="srcline80"> 80</a></span><span class="line">        <span class="keyword">function</span> <span class="var type0" id="S42T0U300">y</span>=get_m(<span class="var type0" id="S43T0U303">obj</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="11,81" id="srcline81"> 81</a></span><span class="line">            <span class="var type0" id="S43T0U308">obj</span>.ind.i=<span class="var type0" id="S43T0U314">obj</span>.ind.i + 1; </span></span>
<span class="srcline"><span class="lineno"><a href="11,82" id="srcline82"> 82</a></span><span class="line">            <span class="keyword">if</span> <span class="var type0" id="S43T0U323">obj</span>.ind.i&gt; <span class="var type0" id="S43T0U328">obj</span>.ind.nCount</span></span>
<span class="srcline"><span class="lineno"><a href="11,83" id="srcline83"> 83</a></span><span class="line">                <span class="var type0" id="S42T0U333">y</span>=1.0;</span></span>
<span class="srcline"><span class="lineno"><a href="11,84" id="srcline84"> 84</a></span><span class="line">                <span class="var type0" id="S43T0U339">obj</span>.mySigmoid.IsForm=false;</span></span>
<span class="srcline"><span class="lineno"><a href="11,85" id="srcline85"> 85</a></span><span class="line">                <span class="keyword">return</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="11,86" id="srcline86"> 86</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="11,87" id="srcline87"> 87</a></span><span class="line">            <span class="keyword">switch</span> max(min(<span class="var type0" id="S43T0U352">obj</span>.ind.sig, 3), 1)</span></span>
<span class="srcline"><span class="lineno"><a href="11,88" id="srcline88"> 88</a></span><span class="line">                <span class="keyword">case</span> 1</span></span>
<span class="srcline"><span class="lineno"><a href="11,89" id="srcline89"> 89</a></span><span class="line">                    <span class="var type0" id="S42T0U361">y</span>=<span class="var type0" id="S43T0U364">obj</span>.M1(<span class="var type0" id="S43T0U368">obj</span>.ind.i);</span></span>
<span class="srcline"><span class="lineno"><a href="11,90" id="srcline90"> 90</a></span><span class="line">                <span class="keyword">case</span> 2 </span></span>
<span class="srcline"><span class="lineno"><a href="11,91" id="srcline91"> 91</a></span><span class="line">                    <span class="var type0" id="S42T0U375">y</span>=<span class="var type0" id="S43T0U378">obj</span>.M2(<span class="var type0" id="S43T0U382">obj</span>.ind.i);</span></span>
<span class="srcline"><span class="lineno"><a href="11,92" id="srcline92"> 92</a></span><span class="line">                <span class="keyword">case</span> 3 </span></span>
<span class="srcline"><span class="lineno"><a href="11,93" id="srcline93"> 93</a></span><span class="line">                    <span class="var type0" id="S42T0U389">y</span>=<span class="var type0" id="S43T0U392">obj</span>.M3(<span class="var type0" id="S43T0U396">obj</span>.ind.i);</span></span>
<span class="srcline"><span class="lineno"><a href="11,94" id="srcline94"> 94</a></span><span class="line">                <span class="keyword">otherwise</span>                        </span></span>
<span class="srcline"><span class="lineno"><a href="11,95" id="srcline95"> 95</a></span><span class="line">                    <span class="var type0" id="S42T0U402">y</span>=1;</span></span>
<span class="srcline"><span class="lineno"><a href="11,96" id="srcline96"> 96</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="11,97" id="srcline97"> 97</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="11,98" id="srcline98"> 98</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="11,99" id="srcline99"> 99</a></span><span class="line">        <span class="keyword">function</span> <span class="var type0" id="S48T0U406">obj</span>=get_front(<span class="var type0" id="S48T0U409">obj</span>, <span class="var type0" id="S49T0U410">u</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="11,100" id="srcline100">100</a></span><span class="line">            <span class="var type0" id="S48T0U415">obj</span>.point.y0 = <span class="var type0" id="S48T0U420">obj</span>.point.y1;</span></span>
<span class="srcline"><span class="lineno"><a href="11,101" id="srcline101">101</a></span><span class="line">            <span class="var type0" id="S48T0U427">obj</span>.point.y1 = <span class="var type0" id="S49T0U430">u</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="11,102" id="srcline102">102</a></span><span class="line">            <span class="var type0" id="S48T0U435">obj</span>.myFront.is_front = <span class="var type0" id="S48T0U441">obj</span>.point.y1 ~= <span class="var type0" id="S48T0U446">obj</span>.point.y0;</span></span>
<span class="srcline"><span class="lineno"><a href="11,103" id="srcline103">103</a></span><span class="line">            <span class="var type0" id="S48T0U453">obj</span>.myFront.i_tik = <span class="var type0" id="S48T0U459">obj</span>.myFront.i_tik + 1</span></span>
<span class="srcline"><span class="lineno"><a href="11,104" id="srcline104">104</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="11,105" id="srcline105">105</a></span><span class="line">            <span class="var type0" id="S48T0U467">obj</span>.myFront.is_signal = abs(<span class="var type0" id="S49T0U474">u</span>) &gt; 0 <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="11,106" id="srcline106">106</a></span><span class="line">                || (abs(<span class="var type0" id="S49T0U481">u</span>) == 0 &amp;&amp; <span class="var type0" id="S48T0U486">obj</span>.myFront.i_tik &lt; <span class="var type0" id="S48T0U491">obj</span>.myFront.i_nCount_tic_null);</span></span>
<span class="srcline"><span class="lineno"><a href="11,107" id="srcline107">107</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="11,108" id="srcline108">108</a></span><span class="line">            <span class="keyword">if</span> ~<span class="var type0" id="S48T0U499">obj</span>.myFront.is_front</span></span>
<span class="srcline"><span class="lineno"><a href="11,109" id="srcline109">109</a></span><span class="line"><span class="comment">% нет фронта считаем тики</span></span></span>
<span class="srcline"><span class="lineno"><a href="11,110" id="srcline110">110</a></span><span class="line">                </span></span>
<span class="srcline"><span class="lineno"><a href="11,111" id="srcline111">111</a></span><span class="line">                <span class="keyword">if</span> <span class="var type0" id="S48T0U507">obj</span>.myFront.i_tik &gt;= <span class="var type0" id="S48T0U512">obj</span>.myFront.i_nCount_tic_null</span></span>
<span class="srcline"><span class="lineno"><a href="11,112" id="srcline112">112</a></span><span class="line">                    <span class="var type0" id="S48T0U519">obj</span>.myFront.i_sum_front=0;</span></span>
<span class="srcline"><span class="lineno"><a href="11,113" id="srcline113">113</a></span><span class="line">                <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="11,114" id="srcline114">114</a></span><span class="line">                 </span></span>
<span class="srcline"><span class="lineno"><a href="11,115" id="srcline115">115</a></span><span class="line">            <span class="keyword">elseif</span> <span class="var type0" id="S48T0U527">obj</span>.point.y1 &gt; <span class="var type0" id="S48T0U532">obj</span>.point.y0</span></span>
<span class="srcline"><span class="lineno"><a href="11,116" id="srcline116">116</a></span><span class="line">                <span class="var type0" id="S48T0U539">obj</span>.myFront.i_tik_save = <span class="var type0" id="S48T0U544">obj</span>.myFront.i_tik;</span></span>
<span class="srcline"><span class="lineno"><a href="11,117" id="srcline117">117</a></span><span class="line"> 				<span class="var type0" id="S48T0U551">obj</span>.myFront.i_tik = 1;</span></span>
<span class="srcline"><span class="lineno"><a href="11,118" id="srcline118">118</a></span><span class="line"> </span></span>
<span class="srcline"><span class="lineno"><a href="11,119" id="srcline119">119</a></span><span class="line">                <span class="keyword">if</span> <span class="var type0" id="S48T0U560">obj</span>.myFront.i_sum_front &lt;= 0</span></span>
<span class="srcline"><span class="lineno"><a href="11,120" id="srcline120">120</a></span><span class="line">                    <span class="var type0" id="S48T0U568">obj</span>.myFront.i_sum_front = 1;</span></span>
<span class="srcline"><span class="lineno"><a href="11,121" id="srcline121">121</a></span><span class="line">                <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="11,122" id="srcline122">122</a></span><span class="line">                    <span class="var type0" id="S48T0U577">obj</span>.myFront.i_sum_front = min(<span class="var type0" id="S48T0U585">obj</span>.myFront.i_sum_front+1, 3);</span></span>
<span class="srcline"><span class="lineno"><a href="11,123" id="srcline123">123</a></span><span class="line">                <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="11,124" id="srcline124">124</a></span><span class="line">            <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="11,125" id="srcline125">125</a></span><span class="line">                <span class="var type0" id="S48T0U595">obj</span>.myFront.i_tik_save = <span class="var type0" id="S48T0U600">obj</span>.myFront.i_tik;</span></span>
<span class="srcline"><span class="lineno"><a href="11,126" id="srcline126">126</a></span><span class="line"> 				<span class="var type0" id="S48T0U607">obj</span>.myFront.i_tik = 1;</span></span>
<span class="srcline"><span class="lineno"><a href="11,127" id="srcline127">127</a></span><span class="line">                </span></span>
<span class="srcline"><span class="lineno"><a href="11,128" id="srcline128">128</a></span><span class="line">                <span class="keyword">if</span> <span class="var type0" id="S48T0U616">obj</span>.myFront.i_sum_front &gt;= 0</span></span>
<span class="srcline"><span class="lineno"><a href="11,129" id="srcline129">129</a></span><span class="line">                    <span class="var type0" id="S48T0U624">obj</span>.myFront.i_sum_front = -1;</span></span>
<span class="srcline"><span class="lineno"><a href="11,130" id="srcline130">130</a></span><span class="line">                <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="11,131" id="srcline131">131</a></span><span class="line">                    <span class="var type0" id="S48T0U634">obj</span>.myFront.i_sum_front = max(<span class="var type0" id="S48T0U642">obj</span>.myFront.i_sum_front-1, -3);</span></span>
<span class="srcline"><span class="lineno"><a href="11,132" id="srcline132">132</a></span><span class="line">                <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="11,133" id="srcline133">133</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="11,134" id="srcline134">134</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="11,135" id="srcline135">135</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="11,136" id="srcline136">136</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="11,137" id="srcline137">137</a></span><span class="line">        <span class="keyword">function</span> inicial_ind(<span class="var type0" id="S54T0U652">obj</span>, <span class="var type0" id="S55T0U653">i0</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="11,138" id="srcline138">138</a></span><span class="line">            <span class="var type0" id="S54T0U658">obj</span>.ind.sig=<span class="var type0" id="S55T0U661">i0</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="11,139" id="srcline139">139</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="11,140" id="srcline140">140</a></span><span class="line">            <span class="keyword">switch</span> max(min(<span class="var type0" id="S54T0U669">obj</span>.ind.sig, 3), 1)</span></span>
<span class="srcline"><span class="lineno"><a href="11,141" id="srcline141">141</a></span><span class="line">                <span class="keyword">case</span> 1 </span></span>
<span class="srcline"><span class="lineno"><a href="11,142" id="srcline142">142</a></span><span class="line">                    <span class="var type0" id="S54T0U680">obj</span>.ind.nCount=<span class="var type0" id="S54T0U684">obj</span>.M1count;        </span></span>
<span class="srcline"><span class="lineno"><a href="11,143" id="srcline143">143</a></span><span class="line">                <span class="keyword">case</span> 2 </span></span>
<span class="srcline"><span class="lineno"><a href="11,144" id="srcline144">144</a></span><span class="line">                    <span class="var type0" id="S54T0U692">obj</span>.ind.nCount=<span class="var type0" id="S54T0U696">obj</span>.M2count;        </span></span>
<span class="srcline"><span class="lineno"><a href="11,145" id="srcline145">145</a></span><span class="line">                <span class="keyword">case</span> 3 </span></span>
<span class="srcline"><span class="lineno"><a href="11,146" id="srcline146">146</a></span><span class="line">                    <span class="var type0" id="S54T0U704">obj</span>.ind.nCount=<span class="var type0" id="S54T0U708">obj</span>.M3count;        </span></span>
<span class="srcline"><span class="lineno"><a href="11,147" id="srcline147">147</a></span><span class="line">                <span class="keyword">otherwise</span>                        </span></span>
<span class="srcline"><span class="lineno"><a href="11,148" id="srcline148">148</a></span><span class="line">                    <span class="var type0" id="S54T0U715">obj</span>.ind.nCount=<span class="var type0" id="S54T0U719">obj</span>.M1count;        </span></span>
<span class="srcline"><span class="lineno"><a href="11,149" id="srcline149">149</a></span><span class="line">                    <span class="var type0" id="S54T0U725">obj</span>.ind.sig=1;</span></span>
<span class="srcline"><span class="lineno"><a href="11,150" id="srcline150">150</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="11,151" id="srcline151">151</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="11,152" id="srcline152">152</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="11,153" id="srcline153">153</a></span><span class="line">        <span class="keyword">function</span> set_sig(<span class="var type0" id="S59T0U733">obj</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="11,154" id="srcline154">154</a></span><span class="line">            <span class="var type0" id="S60T0U736">i</span>=0; </span></span>
<span class="srcline"><span class="lineno"><a href="11,155" id="srcline155">155</a></span><span class="line">            <span class="var type0" id="S61T0U740">j</span>=0; </span></span>
<span class="srcline"><span class="lineno"><a href="11,156" id="srcline156">156</a></span><span class="line">            <span class="var type0" id="S62T0U744">k</span>=0;</span></span>
<span class="srcline"><span class="lineno"><a href="11,157" id="srcline157">157</a></span><span class="line">            <span class="var type0" id="S59T0U750">obj</span>.ind.sig=0;</span></span>
<span class="srcline"><span class="lineno"><a href="11,158" id="srcline158">158</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="11,159" id="srcline159">159</a></span><span class="line">            <span class="var type0" id="S63T0U756">kSig</span>=0.01;</span></span>
<span class="srcline"><span class="lineno"><a href="11,160" id="srcline160">160</a></span><span class="line">            <span class="var type0" id="S64T0U760">nTime</span>=150; <span class="var type0" id="S65T0U764">alfa</span>=10;</span></span>
<span class="srcline"><span class="lineno"><a href="11,161" id="srcline161">161</a></span><span class="line">            <span class="var type0" id="S66T0U768">nSigStart</span>=fix(<span class="var type0" id="S64T0U772">nTime</span>/2);</span></span>
<span class="srcline"><span class="lineno"><a href="11,162" id="srcline162">162</a></span><span class="line">            <span class="var type0" id="S68T0U776">tsig</span>=(-<span class="var type0" id="S63T0U783">kSig</span>*<span class="var type0" id="S66T0U784">nSigStart</span>: <span class="var type0" id="S63T0U785">kSig</span>: <span class="var type0" id="S63T0U787">kSig</span>*<span class="var type0" id="S66T0U788">nSigStart</span>)';</span></span>
<span class="srcline"><span class="lineno"><a href="11,163" id="srcline163">163</a></span><span class="line">            <span class="var type0" id="S59T0U792">obj</span>.M1=(1+exp(-<span class="var type0" id="S68T0U802">tsig</span>.*<span class="var type0" id="S65T0U803">alfa</span>)).^-1;</span></span>
<span class="srcline"><span class="lineno"><a href="11,164" id="srcline164">164</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="11,165" id="srcline165">165</a></span><span class="line">            <span class="var type0" id="S64T0U808">nTime</span>=100; <span class="var type0" id="S65T0U812">alfa</span>=35;</span></span>
<span class="srcline"><span class="lineno"><a href="11,166" id="srcline166">166</a></span><span class="line">            <span class="var type0" id="S66T0U816">nSigStart</span>=fix(<span class="var type0" id="S64T0U820">nTime</span>/2);</span></span>
<span class="srcline"><span class="lineno"><a href="11,167" id="srcline167">167</a></span><span class="line">            <span class="var type0" id="S68T0U824">tsig</span>=(-<span class="var type0" id="S63T0U831">kSig</span>*<span class="var type0" id="S66T0U832">nSigStart</span>: <span class="var type0" id="S63T0U833">kSig</span>: <span class="var type0" id="S63T0U835">kSig</span>*<span class="var type0" id="S66T0U836">nSigStart</span>)';</span></span>
<span class="srcline"><span class="lineno"><a href="11,168" id="srcline168">168</a></span><span class="line">            <span class="var type0" id="S59T0U840">obj</span>.M2=(1+exp(-<span class="var type0" id="S68T0U850">tsig</span>.*<span class="var type0" id="S65T0U851">alfa</span>)).^-1;</span></span>
<span class="srcline"><span class="lineno"><a href="11,169" id="srcline169">169</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="11,170" id="srcline170">170</a></span><span class="line">            <span class="var type0" id="S64T0U856">nTime</span>=50; <span class="var type0" id="S65T0U860">alfa</span>=60;</span></span>
<span class="srcline"><span class="lineno"><a href="11,171" id="srcline171">171</a></span><span class="line">            <span class="var type0" id="S66T0U864">nSigStart</span>=fix(<span class="var type0" id="S64T0U868">nTime</span>/2);</span></span>
<span class="srcline"><span class="lineno"><a href="11,172" id="srcline172">172</a></span><span class="line">            <span class="var type0" id="S68T0U872">tsig</span>=(-<span class="var type0" id="S63T0U879">kSig</span>*<span class="var type0" id="S66T0U880">nSigStart</span>: <span class="var type0" id="S63T0U881">kSig</span>: <span class="var type0" id="S63T0U883">kSig</span>*<span class="var type0" id="S66T0U884">nSigStart</span>)';</span></span>
<span class="srcline"><span class="lineno"><a href="11,173" id="srcline173">173</a></span><span class="line">            <span class="var type0" id="S59T0U888">obj</span>.M3=(1+exp(-<span class="var type0" id="S68T0U898">tsig</span>.*<span class="var type0" id="S65T0U899">alfa</span>)).^-1;</span></span>
<span class="srcline"><span class="lineno"><a href="11,174" id="srcline174">174</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="11,175" id="srcline175">175</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="11,176" id="srcline176">176</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="11,177" id="srcline177">177</a></span><span class="line">        <span class="keyword">function</span> <span class="var type0" id="S71T0U904">v</span> = step_func3(<span class="var type0" id="S72T0U907">obj</span>, <span class="var type0" id="S73T0U908">u</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="11,178" id="srcline178">178</a></span><span class="line">            <span class="var type0" id="S72T0U912">obj</span>.u_sig_k = get_m(<span class="var type0" id="S72T0U916">obj</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="11,179" id="srcline179">179</a></span><span class="line">            <span class="var type0" id="S72T0U920">obj</span>.u_tek = <span class="var type0" id="S72T0U924">obj</span>.u_sm + <span class="var type0" id="S72T0U928">obj</span>.u_delta * <span class="var type0" id="S72T0U931">obj</span>.u_sig_k;</span></span>
<span class="srcline"><span class="lineno"><a href="11,180" id="srcline180">180</a></span><span class="line">            <span class="var type0" id="S71T0U935">v</span>=<span class="var type0" id="S72T0U937">obj</span>.u_tek;</span></span>
<span class="srcline"><span class="lineno"><a href="11,181" id="srcline181">181</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="11,182" id="srcline182">182</a></span><span class="line">            <span class="keyword">if</span> not(<span class="var type0" id="S72T0U945">obj</span>.myFront.is_front)</span></span>
<span class="srcline"><span class="lineno"><a href="11,183" id="srcline183">183</a></span><span class="line">                <span class="keyword">return</span></span></span>
<span class="srcline"><span class="lineno"><a href="11,184" id="srcline184">184</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="11,185" id="srcline185">185</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="11,186" id="srcline186">186</a></span><span class="line">            <span class="keyword">if</span> <span class="var type0" id="S72T0U953">obj</span>.mySigmoid.IsForm</span></span>
<span class="srcline"><span class="lineno"><a href="11,187" id="srcline187">187</a></span><span class="line">                <span class="comment">% происходит формирование сиг</span></span></span>
<span class="srcline"><span class="lineno"><a href="11,188" id="srcline188">188</a></span><span class="line">                <span class="var type0" id="S76T0U958">tfront</span>= min(abs(<span class="var type0" id="S72T0U965">obj</span>.myFront.i_sum_front),3)</span></span>
<span class="srcline"><span class="lineno"><a href="11,189" id="srcline189">189</a></span><span class="line">                <span class="keyword">switch</span> <span class="var type0" id="S76T0U970">tfront</span></span></span>
<span class="srcline"><span class="lineno"><a href="11,190" id="srcline190">190</a></span><span class="line">                    <span class="keyword">case</span> 1</span></span>
<span class="srcline"><span class="lineno"><a href="11,191" id="srcline191">191</a></span><span class="line">                        <span class="var type0" id="S79T0U975">d</span>=find(<span class="var type0" id="S72T0U980">obj</span>.M1&gt;<span class="var type0" id="S72T0U983">obj</span>.u_sig_k, 1);</span></span>
<span class="srcline"><span class="lineno"><a href="11,192" id="srcline192">192</a></span><span class="line">                        <span class="var type0" id="S72T0U989">obj</span>.u_sig_k = <span class="var type0" id="S72T0U993">obj</span>.M1(<span class="var type0" id="S79T0U996">d</span>(1),1);</span></span>
<span class="srcline"><span class="lineno"><a href="11,193" id="srcline193">193</a></span><span class="line">                        <span class="var type0" id="S72T0U1003">obj</span>.ind.i=<span class="var type0" id="S79T0U1007">d</span>(1);</span></span>
<span class="srcline"><span class="lineno"><a href="11,194" id="srcline194">194</a></span><span class="line">                        <span class="var type0" id="S72T0U1013">obj</span>.ind.nCount=<span class="var type0" id="S72T0U1017">obj</span>.M1count;        </span></span>
<span class="srcline"><span class="lineno"><a href="11,195" id="srcline195">195</a></span><span class="line">                        <span class="var type0" id="S72T0U1023">obj</span>.ind.sig=1;</span></span>
<span class="srcline"><span class="lineno"><a href="11,196" id="srcline196">196</a></span><span class="line">                    <span class="keyword">case</span> 2</span></span>
<span class="srcline"><span class="lineno"><a href="11,197" id="srcline197">197</a></span><span class="line">                        <span class="var type0" id="S79T0U1031">d</span>=find(<span class="var type0" id="S72T0U1036">obj</span>.M2&gt;<span class="var type0" id="S72T0U1039">obj</span>.u_sig_k, 1);</span></span>
<span class="srcline"><span class="lineno"><a href="11,198" id="srcline198">198</a></span><span class="line">                        <span class="var type0" id="S72T0U1045">obj</span>.u_sig_k = <span class="var type0" id="S72T0U1049">obj</span>.M2(<span class="var type0" id="S79T0U1052">d</span>(1),1);</span></span>
<span class="srcline"><span class="lineno"><a href="11,199" id="srcline199">199</a></span><span class="line">                        <span class="var type0" id="S72T0U1059">obj</span>.ind.i=<span class="var type0" id="S79T0U1063">d</span>(1);</span></span>
<span class="srcline"><span class="lineno"><a href="11,200" id="srcline200">200</a></span><span class="line">                        <span class="var type0" id="S72T0U1068">obj</span>.u_sig_k = <span class="var type0" id="S72T0U1072">obj</span>.M2(<span class="var type0" id="S72T0U1076">obj</span>.ind.i);</span></span>
<span class="srcline"><span class="lineno"><a href="11,201" id="srcline201">201</a></span><span class="line">                        <span class="var type0" id="S72T0U1083">obj</span>.ind.nCount=<span class="var type0" id="S72T0U1087">obj</span>.M2count;        </span></span>
<span class="srcline"><span class="lineno"><a href="11,202" id="srcline202">202</a></span><span class="line">                        <span class="var type0" id="S72T0U1093">obj</span>.ind.sig=2;</span></span>
<span class="srcline"><span class="lineno"><a href="11,203" id="srcline203">203</a></span><span class="line">                    <span class="keyword">case</span> 3 </span></span>
<span class="srcline"><span class="lineno"><a href="11,204" id="srcline204">204</a></span><span class="line">                        <span class="var type0" id="S79T0U1101">d</span>=find(<span class="var type0" id="S72T0U1106">obj</span>.M3&gt;<span class="var type0" id="S72T0U1109">obj</span>.u_sig_k, 1);</span></span>
<span class="srcline"><span class="lineno"><a href="11,205" id="srcline205">205</a></span><span class="line">                        <span class="var type0" id="S72T0U1115">obj</span>.u_sig_k = <span class="var type0" id="S72T0U1119">obj</span>.M3(<span class="var type0" id="S79T0U1122">d</span>(1),1);</span></span>
<span class="srcline"><span class="lineno"><a href="11,206" id="srcline206">206</a></span><span class="line">                        <span class="var type0" id="S72T0U1129">obj</span>.ind.i=<span class="var type0" id="S79T0U1133">d</span>(1);</span></span>
<span class="srcline"><span class="lineno"><a href="11,207" id="srcline207">207</a></span><span class="line">                        <span class="var type0" id="S72T0U1138">obj</span>.u_sig_k = <span class="var type0" id="S72T0U1142">obj</span>.M3(<span class="var type0" id="S72T0U1146">obj</span>.ind.i);</span></span>
<span class="srcline"><span class="lineno"><a href="11,208" id="srcline208">208</a></span><span class="line">                        <span class="var type0" id="S72T0U1153">obj</span>.ind.nCount=<span class="var type0" id="S72T0U1157">obj</span>.M3count;        </span></span>
<span class="srcline"><span class="lineno"><a href="11,209" id="srcline209">209</a></span><span class="line">                        <span class="var type0" id="S72T0U1163">obj</span>.ind.sig=3;</span></span>
<span class="srcline"><span class="lineno"><a href="11,210" id="srcline210">210</a></span><span class="line">                    <span class="keyword">otherwise</span>                        </span></span>
<span class="srcline"><span class="lineno"><a href="11,211" id="srcline211">211</a></span><span class="line">                        <span class="var type0" id="S72T0U1172">obj</span>.ind.i=100;</span></span>
<span class="srcline"><span class="lineno"><a href="11,212" id="srcline212">212</a></span><span class="line">                        <span class="var type0" id="S72T0U1179">obj</span>.u_sig_k =1;</span></span>
<span class="srcline"><span class="lineno"><a href="11,213" id="srcline213">213</a></span><span class="line">                        <span class="var type0" id="S72T0U1186">obj</span>.ind.nCount=1;        </span></span>
<span class="srcline"><span class="lineno"><a href="11,214" id="srcline214">214</a></span><span class="line">                        <span class="var type0" id="S72T0U1194">obj</span>.ind.sig=4;</span></span>
<span class="srcline"><span class="lineno"><a href="11,215" id="srcline215">215</a></span><span class="line">                <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="11,216" id="srcline216">216</a></span><span class="line">                <span class="var type0" id="S72T0U1201">obj</span>.u_sm = <span class="var type0" id="S72T0U1204">obj</span>.u_tek;</span></span>
<span class="srcline"><span class="lineno"><a href="11,217" id="srcline217">217</a></span><span class="line">                <span class="var type0" id="S72T0U1209">obj</span>.u_delta = <span class="var type0" id="S73T0U1212">u</span> - <span class="var type0" id="S72T0U1214">obj</span>.u_tek;</span></span>
<span class="srcline"><span class="lineno"><a href="11,218" id="srcline218">218</a></span><span class="line">                <span class="var type0" id="S72T0U1220">obj</span>.ind.i = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="11,219" id="srcline219">219</a></span><span class="line">            <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="11,220" id="srcline220">220</a></span><span class="line">                <span class="comment">% сиг с формирована</span></span></span>
<span class="srcline"><span class="lineno"><a href="11,221" id="srcline221">221</a></span><span class="line">                inicial_ind(<span class="var type0" id="S72T0U1228">obj</span>, abs(<span class="var type0" id="S72T0U1233">obj</span>.myFront.i_sum_front))</span></span>
<span class="srcline"><span class="lineno"><a href="11,222" id="srcline222">222</a></span><span class="line">                <span class="var type0" id="S72T0U1239">obj</span>.u_sm = <span class="var type0" id="S72T0U1242">obj</span>.u_tek;</span></span>
<span class="srcline"><span class="lineno"><a href="11,223" id="srcline223">223</a></span><span class="line">                <span class="var type0" id="S72T0U1247">obj</span>.u_delta = <span class="var type0" id="S73T0U1250">u</span> - <span class="var type0" id="S72T0U1252">obj</span>.u_tek;</span></span>
<span class="srcline"><span class="lineno"><a href="11,224" id="srcline224">224</a></span><span class="line">                <span class="var type0" id="S72T0U1258">obj</span>.ind.i = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="11,225" id="srcline225">225</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="11,226" id="srcline226">226</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="11,227" id="srcline227">227</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="11,228" id="srcline228">228</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="11,229" id="srcline229">229</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="11,230" id="srcline230">230</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="11,231" id="srcline231">231</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="11,232" id="srcline232">232</a></span><span class="line"> </span></span>
</pre>
</div>
</body>
</html>
